<polymer-element name="ceci-component-sheet" extends="ceci-element" attributes="height url">
  <ceci-definition>
    {
      "name": "Sheet",
      "tags": "ceci-component-sheet",
      "thumbnail": "./thumbnail.png",
      "description": "A canvas for drawing and sharing",
      "broadcasts": {
        "cellclicked": {
          "label": "Cell Tapped",
          "description": "A cell was tapped",
          "default": "green"
        }
      },
      "listeners": {
      },
      "attributes": {
        "url": {
          "label": "Google Docs URL",
          "description": "URL",
          "editable": "text"
        }
      }
    }
  </ceci-definition>
  <template>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles/h5bp.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components/components.css">
    <link rel="stylesheet" href="component.css">
    <table id="table">
      <thead id="thead">
      </thead>
      <tbody id="tbody">
      </tbody>
    </table>
    <shadow></shadow>
  </template>
    <script>
require(['jquery'], function($) {
      Polymer("ceci-component-sheet", {
        readonly: 'false',
        pensize: 5,
        height: 100,
        generateonchange: 'false',
        heightChanged: function () {
          this.style.height = this.height + 'px';
          this.async(function () {
            var rect = this.getBoundingClientRect();
            this.$.canvas.width = rect.width;
            this.$.canvas.height = rect.height;
          });
        },
        ready: function() {
          this.super();

          var that = this;
          $.getJSON("http://localhost:4000/data", function(payload) {
            var items = [];
            var cells = [];
            var title = payload.title;
            var data = payload.data;
            $.each( data[0], function( key, val ) {
              cells.push("<th>" + val + "</th>");
            });
            $("<tr/>", {id:"header", html: cells.join("")}).appendTo($(that.$.thead));
            $.each( data.slice(1), function( key, val ) {
              cells = [];
              $.each(val, function(key, cell) {
                if (data[0][key] == 'Email') {
                  cell = "<a Xhref='mailto:" + cell + "'>"+cell+"</a>";
                } else if (data[0][key] == 'Phone') {
                  cell = "<a Xhref='tel:" + cell + "'>"+cell+"</a>";
                }
                cells.push("<td class='large' data-th='"+data[0][key]+"'>" + cell + "</td>");
              });
              var bits = $("<tr/>", {html: cells.join("")});
              bits.appendTo($(that.$.tbody));
            });
            console.log("body", $(that.$.tbody));
            var links = that.$.tbody.querySelectorAll('a');
            console.log("LINKS", links);
            Array.prototype.forEach.call(links, function(link) {
              link.on('click', function(evt) {
                console.log(evt);
              });
            });
          });
          this.super();
        }
      });
});
    </script>
</polymer-element>
